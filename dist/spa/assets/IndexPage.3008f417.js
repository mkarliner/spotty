import{Q as R}from"./QPage.dd4248e4.js";import{u as I}from"./mqtt-vue-hook.es.f3d9172b.js";import{_ as y,r as i,M as a,b as h,F as C,G as d,H as u,c as w,V as O,W as D,O as A}from"./index.4fcf7ea8.js";import"./render.2c496e92.js";var P=65,N=function(o){return o.match(/^[A-Ra-r][A-Ra-r]\d\d[A-Xa-x][A-Xa-x]/)!==null},g=function(o){return o.toUpperCase().charCodeAt(0)-P},L=function(o){return String.fromCharCode(o+P)},q=function(o){if(o+="ll",!N(o))throw new Error("Input is not valid locator string");var e=g(o[0])*20,t=g(o[1])*10,n=Number.parseInt(o[2])*2,c=Number.parseInt(o[3]),s=(g(o[4])+.5)/12,l=(g(o[5])+.5)/24;return[t+c+l-90,e+n+s-180]},b=function(o){return o%360*Math.PI/180},E=function(o){return o/Math.PI*180%360},x=function(o,e){var t=q(o),n=q(e),c=b(n[0]-t[0]),s=b(n[1]-t[1]),l=b(t[0]),_=b(n[0]),p=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(_),m=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),f=s*Math.cos(l)*Math.cos(_),M=Math.sin(_)-Math.sin(l)*Math.cos(m),v=Math.atan2(f,M);return v<0&&(v+=2*Math.PI),{km:m*6371,deg:E(v)}},V=function(o,e){return x(o,e).km},z=function(o,e){return o>=-90&&o<=90&&e>=-180&&e<=180},W=function(o,e){if(!z(o,e))throw new Error("Input is not a valid coordinate");var t=e+180,n=o+90,c=L(Math.floor(t/20)),s=L(Math.floor(n/10)),l=Math.floor(t%20/2),_=Math.floor(n%10),p=L(Math.floor(t%20%2*12)).toLowerCase(),m=L((n%10-_)*24).toLowerCase();return c+s+l+_+p+m},$={isValidLocatorString:N,locatorToLatLng:q,distance:V,bearingDistance:x,latLngToLocator:W};const j={name:"ReportPoint",props:["coordinate","sequenceNumber"],emits:["delete"],setup(){const r=i(3),o=i(1),e=i("red"),t=i("white");return{radius:r,strokeWidth:o,strokeColor:e,fillColor:t}},data(){return{to:null}},mounted(){},methods:{clearTo(){this.to&&(console.log("Clearing",this.to),clearTimeout(this.to))}},components(){}};function B(r,o,e,t,n,c){const s=a("ol-geom-point"),l=a("ol-style-fill"),_=a("ol-style-stroke"),p=a("ol-style-circle"),m=a("ol-style"),f=a("ol-feature");return h(),C(f,null,{default:d(()=>[u(s,{coordinates:e.coordinate},null,8,["coordinates"]),u(m,null,{default:d(()=>[u(p,{radius:t.radius},{default:d(()=>[u(l,{color:t.fillColor},null,8,["color"]),u(_,{color:t.strokeColor,width:t.strokeWidth},null,8,["color","width"])]),_:1},8,["radius"])]),_:1})]),_:1})}var F=y(j,[["render",B]]);const k=I(),H={mounted(){console.log("blah"),console.log("Mounted"),this.$refs.view.updateSize(),k.subscribe(["pskr/filter/+/+/+/+/IO91/#"]),k.registerEvent("pskr/filter/+/+/+/+/IO91/#",(r,o)=>{const e=JSON.parse(o.toString()),[t,n]=$.locatorToLatLng(e.receiverLocator),c=[n,t];console.log("RP:",Object.keys(this.report_points).length),this.report_points.hasOwnProperty(e.seqenceNumber)?console.log("ALERT, Duplicate"):(this.report_points[e.sequenceNumber]={sequenceNumber:e.sequenceNumber,coordinate:c},setTimeout(()=>{console.log("bye bye",e.sequenceNumber),delete this.report_points[e.sequenceNumber]},15e3))})},setup(){const r=i([-.224,51.555]),o=i("EPSG:4326"),e=i(0),t=i(0),n=i(5),c=i(10),s=i("red"),l=i("white"),_=i([-.224,51.555]);return console.log("Boo!"),{center:r,projection:o,zoom:e,rotation:t,radius:n,strokeWidth:c,strokeColor:s,fillColor:l,coordinate:_}},data(){return{report_points:{}}},methods:{deleteRP(r){console.log("Deletion",r),delete this.report_points[r]}},components:{ReportPoint:F}};function Q(r,o,e,t,n,c){const s=a("ol-view"),l=a("ol-source-osm"),_=a("ol-tile-layer"),p=a("ReportPoint"),m=a("ol-feature"),f=a("ol-source-vector"),M=a("ol-vector-layer"),v=a("ol-map",!0);return h(),w("div",null,[u(v,{loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,ref:"view",style:{"margin-left":"-50%",width:"100%",top:"0",bottom:"0",position:"absolute"}},{default:d(()=>[u(s,{center:t.center,rotation:t.rotation,zoom:t.zoom,projection:t.projection},null,8,["center","rotation","zoom","projection"]),u(_,null,{default:d(()=>[u(l)]),_:1}),u(M,null,{default:d(()=>[u(f,null,{default:d(()=>[(h(!0),w(O,null,D(n.report_points,T=>(h(),C(m,{key:T.seqenceNumber},{default:d(()=>[u(p,{onDelete:c.deleteRP,sequenceNumber:T.sequenceNumber,coordinate:T.coordinate},null,8,["onDelete","sequenceNumber","coordinate"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512)])}var G=y(H,[["render",Q]]);const S=A({name:"IndexPage",components:{OlMap:G}});function X(r,o,e,t,n,c){const s=a("OlMap");return h(),C(R,{class:"flex flex-center"},{default:d(()=>[u(s)]),_:1})}var Z=y(S,[["render",X]]);export{Z as default};
